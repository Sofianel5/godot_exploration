[gd_scene load_steps=8 format=3 uid="uid://b4p8qyxvghjm8"]

[ext_resource type="PackedScene" uid="uid://dpqxvpwqjlvff" path="res://scenes/Player.tscn" id="1_0x8b2"]
[ext_resource type="PackedScene" uid="uid://bh8yn4qxd8w7h" path="res://scenes/Enemy.tscn" id="2_3k9m4"]
[ext_resource type="PackedScene" uid="uid://cjxm7y4n8p2qr" path="res://scenes/UI.tscn" id="3_ui"]

[sub_resource type="GDScript" id="GDScript_1"]
script/source = "extends Node3D

var enemy_scene = preload(\"res://scenes/Enemy.tscn\")
var spawn_points = [
	Vector3(5, 1.1, 5),
	Vector3(-5, 1.1, 5),
	Vector3(5, 1.1, -5),
	Vector3(-5, 1.1, -5),
	Vector3(0, 1.1, 8),
	Vector3(0, 1.1, -8),
	Vector3(8, 1.1, 0),
	Vector3(-8, 1.1, 0)
]

func _ready():
	print(\"Main scene ready - enemy spawning system active\")

func on_enemy_died():
	print(\"Enemy died! Spawning new one...\")
	
	# Wait a moment before spawning
	var timer = Timer.new()
	add_child(timer)
	timer.wait_time = 1.0
	timer.one_shot = true
	timer.timeout.connect(spawn_new_enemy)
	timer.timeout.connect(func(): timer.queue_free())
	timer.start()

func spawn_new_enemy():
	var new_enemy = enemy_scene.instantiate()
	
	# Choose random spawn point
	var spawn_pos = spawn_points[randi() % spawn_points.size()]
	new_enemy.global_position = spawn_pos
	
	add_child(new_enemy)
	print(\"New enemy spawned at: \", spawn_pos)
"

[sub_resource type="BoxMesh" id="BoxMesh_1"]

[sub_resource type="BoxShape3D" id="BoxShape3D_1"]

[sub_resource type="Environment" id="Environment_1"]
background_mode = 1
background_color = Color(0.5, 0.7, 1, 1)
ambient_light_source = 2
ambient_light_color = Color(1, 1, 1, 1)
ambient_light_energy = 0.3

[node name="Main" type="Node3D"]
script = SubResource("GDScript_1")

[node name="Environment" type="Node3D" parent="."]

[node name="Ground" type="StaticBody3D" parent="Environment"]
collision_layer = 2

[node name="GroundMesh" type="MeshInstance3D" parent="Environment/Ground"]
transform = Transform3D(20, 0, 0, 0, 1, 0, 0, 0, 20, 0, 0, 0)
mesh = SubResource("BoxMesh_1")

[node name="GroundCollision" type="CollisionShape3D" parent="Environment/Ground"]
transform = Transform3D(20, 0, 0, 0, 1, 0, 0, 0, 20, 0, 0, 0)
shape = SubResource("BoxShape3D_1")

[node name="Wall1" type="StaticBody3D" parent="Environment"]
transform = Transform3D(1, 0, 0, 0, 3, 0, 0, 0, 20, -10, 1.5, 0)
collision_layer = 2

[node name="Wall1Mesh" type="MeshInstance3D" parent="Environment/Wall1"]
mesh = SubResource("BoxMesh_1")

[node name="Wall1Collision" type="CollisionShape3D" parent="Environment/Wall1"]
shape = SubResource("BoxShape3D_1")

[node name="Wall2" type="StaticBody3D" parent="Environment"]
transform = Transform3D(1, 0, 0, 0, 3, 0, 0, 0, 20, 10, 1.5, 0)
collision_layer = 2

[node name="Wall2Mesh" type="MeshInstance3D" parent="Environment/Wall2"]
mesh = SubResource("BoxMesh_1")

[node name="Wall2Collision" type="CollisionShape3D" parent="Environment/Wall2"]
shape = SubResource("BoxShape3D_1")

[node name="Wall3" type="StaticBody3D" parent="Environment"]
transform = Transform3D(20, 0, 0, 0, 3, 0, 0, 0, 1, 0, 1.5, -10)
collision_layer = 2

[node name="Wall3Mesh" type="MeshInstance3D" parent="Environment/Wall3"]
mesh = SubResource("BoxMesh_1")

[node name="Wall3Collision" type="CollisionShape3D" parent="Environment/Wall3"]
shape = SubResource("BoxShape3D_1")

[node name="Wall4" type="StaticBody3D" parent="Environment"]
transform = Transform3D(20, 0, 0, 0, 3, 0, 0, 0, 1, 0, 1.5, 10)
collision_layer = 2

[node name="Wall4Mesh" type="MeshInstance3D" parent="Environment/Wall4"]
mesh = SubResource("BoxMesh_1")

[node name="Wall4Collision" type="CollisionShape3D" parent="Environment/Wall4"]
shape = SubResource("BoxShape3D_1")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.707107, -0.5, 0.5, 0, 0.707107, 0.707107, -0.707107, -0.5, 0.5, 0, 5, 0)

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_1")

[node name="Player" parent="." instance=ExtResource("1_0x8b2")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.1, 0)

[node name="Enemy" parent="." instance=ExtResource("2_3k9m4")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5, 1.1, 5)

[node name="UI" parent="." instance=ExtResource("3_ui")]
grow_horizontal = 2
grow_vertical = 2
